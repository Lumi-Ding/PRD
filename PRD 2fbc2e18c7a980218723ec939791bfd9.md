# PRD

# 跨租户Profile关联功能设计方案

基于您提供的文档和业务需求,我将从产品角度设计一套**跨租户Profile智能关联与管理**的功能方案。

## 一、核心业务场景分析

### 1.1 用户痛点识别

根据文档中的Multi-Tenant架构,当前面临的关键问题:

- **数据孤岛风险**: 同一员工在不同租户(如SeaGroup、Monee、Maribank)可能存在多个Profile,但系统缺乏自动关联机制
- **人工核对成本高**: 依赖HR手动识别同一个人的多个Profile,效率低且易出错
- **异常状态处理难**: 可能出现一个人同时拥有多个Active+Primary Profile的不合理情况

### 1.2 业务价值

- **提升数据准确性**: 自动识别潜在重复Profile,减少数据冗余
- **降低运营成本**: 减少HR手动核对工作量
- **合规性保障**: 确保Person ID的唯一性,满足审计要求

---

## 二、产品功能设计

### **功能1: 智能Profile关联引擎**

### 2.1.1 自动匹配逻辑

基于文档中的"Potential Duplicate Information"机制扩展:

**匹配规则分级**:

`高置信度匹配(自动建议关联):
├─ 证件号码(ID Type + ID No.)完全一致
├─ 个人邮箱(Personal Email)完全一致
└─ Full Name(Local Language) + Date of Birth 完全一致

中置信度匹配(提示人工审核):
├─ Display Name相似度>90% + Contact Number一致
├─ Full Name(English) + Nationality一致
└─ Office Email前缀一致(如allen.gu@sea.com与allen.gu@monee.com)

低置信度匹配(仅作提醒):
├─ Display Name相似度60-90%
└─ Contact Number一致但其他信息不匹配`

### 2.1.2 触发时机

- **实时触发**: 在Add Profile时(Step 1完成后),系统立即检测
- **批量扫描**: 每日定时任务,扫描全租户范围内的潜在重复
- **手动触发**: 管理员可在Profile Details页面手动发起关联检测

---

### **功能2: 上级管理员确认工作流**

### 2.2.1 确认界面设计

**场景1: 新增Profile时触发**

`弹窗标题: "Potential Cross-Tenant Profile Detected"

内容区域:
┌────────────────────────────────────────┐
│ 系统检测到以下Profile可能属于同一人:    │
│                                        │
│ 当前新增Profile (待确认):              │
│ ├─ Tenant: Seabank ID                 │
│ ├─ Display Name: Allen Gu             │
│ ├─ Personal Email: allen@example.com  │
│ └─ ID No.: ***1234                    │
│                                        │
│ 已存在Profile:                         │
│ ┌──────────────────────────────────┐  │
│ │ [高置信度匹配 - 90%]              │  │
│ │ Person ID: SE000003               │  │
│ │ Tenant: Sea Group > Monee         │  │
│ │ Staff ID: SGB0001                 │  │
│ │ Status: Active (Primary)          │  │
│ │ Personal Email: allen@example.com │  │
│ │ ID No.: ***1234                   │  │
│ │ [View Full Profile]               │  │
│ └──────────────────────────────────┘  │
│                                        │
│ 匹配依据:                              │
│ ✓ Personal Email完全一致               │
│ ✓ ID No.完全一致                       │
│ ✓ Display Name一致                    │
│                                        │
│ 操作选项:                              │
│ ○ 关联为同一人(继承Person ID SE000003) │
│ ○ 确认为不同人(创建新Person ID)        │
│ ○ 稍后处理(暂存为Draft)                │
└────────────────────────────────────────┘

[Confirm]  [View More Details]  [Cancel]`

### 2.2.2 权限设计

基于文档中的权限体系:

**权限层级**:

`L1: 查看跨租户关联建议
    ├─ Smart Role: Reporting Manager (可查看下属的关联建议)
    └─ Action: Staff Profile > View Cross-Tenant Link Suggestion

L2: 确认/拒绝关联建议
    ├─ Role: Group HR Manager (可处理本租户及子租户)
    └─ Action: Staff Profile > Confirm Cross-Tenant Link

L3: 强制解除关联(高级功能)
    ├─ Role: Super Manager / System Admin
    └─ Action: Staff Profile > Advanced > Break Cross-Tenant Link`

---

### **功能3: 多Active+Primary Profile冲突处理**

### 2.3.1 异常检测规则

根据文档"A Person Profile can only have one primary Employment Profile",扩展跨租户检测:

**检测逻辑**:

python

`# 伪代码示例
IF Person_ID相同 AND 存在多个Profile满足:
   (Status = Active OR Leaving) AND Primary Tag = Yes
THEN 触发冲突告警
```

#### 2.3.2 处理界面

**冲突提示页面**:
```
⚠️ 异常状态检测

Person ID: SE000003 (Allen Gu)
问题: 检测到该员工存在多个Active+Primary Profile,违反业务规则

┌─────────────────────────────────────────┐
│ Profile 1:                              │
│ Tenant: Sea Group > Monee               │
│ Staff ID: SGB0001                       │
│ Status: Active | Primary: Yes           │
│ Legal Entity: Monee Singapore Pte Ltd   │
│ Joining Date: 01/01/2023                │
│ [View Details] [Set as Non-Primary]     │
├─────────────────────────────────────────┤
│ Profile 2:                              │
│ Tenant: Sea Group > Monee > Maribank    │
│ Staff ID: MBK0001                       │
│ Status: Active | Primary: Yes ⚠️        │
│ Legal Entity: Maribank Singapore        │
│ Joining Date: 01/03/2025                │
│ [View Details] [Set as Non-Primary]     │
└─────────────────────────────────────────┘

建议操作:
1. 确认哪个Profile为主要雇佣关系(保留Primary Tag)
2. 将其他Profile的Primary Tag改为No
3. 如为Concurrent Employment,请确保业务场景合理

[解决冲突向导]  [联系HR支持]
```

#### 2.3.3 自动修正建议
```
系统智能建议逻辑:
1. 若Joining Date不同,建议最新的Profile为Primary
2. 若存在Payroll Tag=Yes,优先建议该Profile为Primary
3. 若Legal Entity层级不同,建议子租户Profile为Primary
4. 提供一键修正按钮,但需二次确认
```

---

### **功能4: 跨租户Profile管理中心**

#### 2.4.1 新增管理页面
在Profile Details页面增加Tab: **"Cross-Tenant Links"**

**页面布局**:
```
┌─ Profile Details ─────────────────────────┐
│ [Overview] [Employment] [Personal]        │
│ [Notes] [Career Path] [Cross-Tenant Links]│ ← 新增
└───────────────────────────────────────────┘

Cross-Tenant Links Tab内容:
┌────────────────────────────────────────┐
│ Person ID: SE000003                    │
│ 该员工在以下租户拥有Profile:            │
│                                        │
│ ┌────────────────────────────────────┐ │
│ │ ✓ Sea Group > Monee                │ │
│ │   Staff ID: SGB0001                │ │
│ │   Status: Active | Primary         │ │
│ │   [View Profile]                   │ │
│ ├────────────────────────────────────┤ │
│ │ ✓ Sea Group > Monee > Maribank     │ │
│ │   Staff ID: MBK0001                │ │
│ │   Status: Active                   │ │
│ │   [View Profile]                   │ │
│ └────────────────────────────────────┘ │
│                                        │
│ 待确认关联建议:                        │
│ ┌────────────────────────────────────┐ │
│ │ ? Sea Group > Monee > Seabank ID   │ │
│ │   Staff ID: IBD0002                │ │
│ │   匹配置信度: 75% (中)              │ │
│ │   [确认关联] [拒绝] [详情]          │ │
│ └────────────────────────────────────┘ │
│                                        │
│ [手动添加关联]                         │
└────────────────────────────────────────┘
```

#### 2.4.2 关联操作记录
所有关联操作记录到Audit Log:
```
Actioned By: admin@shopee.com
Actioned On: 02/02/2026
Actioned Type: Confirm Cross-Tenant Link
Actioned On Section: Cross-Tenant Links
Value Before: Unlinked
Value After: Linked to Person ID SE000003 (SGB0001, MBK0001)
```

---

### **功能5: 批量关联管理工具**

#### 2.5.1 管理员批量审核页面
在Tenant Management下新增: **"Cross-Tenant Profile Review"**

**功能点**:
```
筛选条件:
├─ 匹配置信度: [高/中/低]
├─ 状态: [待审核/已确认/已拒绝]
├─ 租户范围: [当前租户/包含子租户]
└─ 创建时间: [日期范围]

列表展示:
┌──────┬─────────┬──────────┬────────┬────────┐
│ 选择 │Person ID│候选Profile│置信度  │ 操作   │
├──────┼─────────┼──────────┼────────┼────────┤
│ ☑    │SE000003 │2个候选   │ 高(95%)│[审核]  │
│ ☑    │SE000005 │3个候选   │ 中(78%)│[审核]  │
│ □    │SE000008 │2个候选   │ 低(62%)│[审核]  │
└──────┴─────────┴──────────┴────────┴────────┘

批量操作:
[批量确认关联]  [批量拒绝]  [导出报告]
```

#### 2.5.2 Mass Update支持
扩展Mass Update模板,新增字段:
```
新增字段:
├─ Link_to_Person_ID (关联到已存在的Person ID)
├─ Override_Duplicate_Check (强制跳过重复检测,仅Super Admin可用)
└─ Cross_Tenant_Link_Action (操作类型: Link/Unlink/Ignore)
```

---

## 三、技术实现要点(产品视角)

### 3.1 数据模型扩展
基于文档中的Person ID Table,新增关联状态表:

**Cross_Tenant_Link_Suggestion表** (产品逻辑描述):
```
字段说明:
├─ Suggestion_ID: 建议记录唯一标识
├─ Person_ID_A: 已存在的Person ID
├─ Person_ID_B: 候选关联的Person ID (可能为空)
├─ Profile_ID_Candidate: 候选Profile的ID
├─ Match_Score: 匹配分数(0-100)
├─ Match_Rules: 匹配依据(JSON格式存储)
├─ Status: 待审核/已确认/已拒绝/已过期
├─ Reviewed_By: 审核人
├─ Reviewed_At: 审核时间
└─ Tenant_Scope: 可见租户范围
```

### 3.2 与现有流程整合

**整合点1: Add Profile流程**
```
Step 1: 基础信息填写
  ↓
系统检测潜在重复 (新增)
  ↓
├─ 无匹配 → 继续Step 2
├─ 高置信度匹配 → 弹窗确认关联
└─ 中/低置信度 → 提示但允许继续
  ↓
Step 2: Personal Information
  ↓
Step 3: Employment Information
```

**整合点2: Re-hire/Transfer场景**
根据文档2.1 Staff Profile Action:
- Re-hire时,强制检查是否存在Inactive Profile需要关联
- Transfer (Cross Entity)时,自动关联源租户和目标租户的Profile

---`

`## 四、用户体验优化

### 4.1 渐进式提示
```
第一次遇到关联建议:
├─ 显示详细操作指引
├─ 提供"什么是跨租户关联?"帮助链接
└─ 允许"不再提示此类信息"(但会在Dashboard保留提醒)

重复遇到关联建议:
├─ 简化提示界面
└─ 提供快捷操作按钮
```

### 4.2 移动端支持
在Profile Details的Action菜单中增加:
```
[Actions for HR]
├─ Re-hire
├─ Transfer
├─ Offboard
├─ Review Cross-Tenant Links (新增,带红点提醒)
└─ ...
```

---

## 五、分阶段实施建议

### Phase 1: 基础检测 (优先级: 高)
- ✅ 实现自动匹配逻辑(高置信度规则)
- ✅ Add Profile时弹窗确认
- ✅ 冲突检测与告警

### Phase 2: 管理工具 (优先级: 中)
- ✅ Cross-Tenant Links管理页面
- ✅ 批量审核工具
- ✅ Audit Log记录

### Phase 3: 智能优化 (优先级: 低)
- ✅ 机器学习优化匹配算法
- ✅ 自动修正建议
- ✅ 数据质量报告

---

## 六、关键指标(KPI)

衡量功能效果:
```
效率指标:
├─ 人工审核时间减少: 目标>60%
├─ 重复Profile发现率: 目标>90%
└─ 自动关联准确率: 目标>95%

质量指标:
├─ 多Primary冲突发现率: 目标100%
├─ 误关联率: 目标<2%
└─ 用户满意度: 目标>4.5/5`

---

## 七、风险与应对

### 7.1 数据隐私风险

**问题**: 跨租户数据可见性可能违反某些地区法规(如印尼LDN)

**应对**:

- 根据文档中的Storage Requirement,为敏感租户(如ID entities)单独部署
- 关联建议仅显示脱敏数据(如ID No.显示为`**1234`)
- 增加审计日志,记录所有跨租户数据访问

### 7.2 误关联风险

**问题**: 系统误将两个不同人关联

**应对**:

- 高置信度匹配也需人工确认(不自动关联)
- 提供"解除关联"功能(需审批流程)
- 保留历史关联记录,可回溯

---

## 八、总结

该方案通过**智能检测+人工审核+异常处理**的三层机制,既保证了自动化效率,又确保了数据准确性。核心亮点:

1. **非侵入式设计**: 无缝整合到现有Add Profile和Edit Profile流程
2. **分级匹配策略**: 平衡自动化与准确性
3. **合规性保障**: 支持租户隔离和审计要求
4. **可扩展性**: 为未来AI优化预留接口

该功能将显著提升HR运营效率,同时满足Multi-Tenant架构下的复杂业务需求。

[Start your own conversation](https://www.notion.so/project/019c1c3a-726f-77f8-a349-8be613e0ac29)